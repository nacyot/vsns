function setup_wmd(e){return new WMDEditor(e)}!function(){function e(){var e={};return e.isIE=/msie/.test(c.userAgent.toLowerCase()),e.isIE_5or6=/msie 6/.test(c.userAgent.toLowerCase())||/msie 5/.test(c.userAgent.toLowerCase()),e.isIE_7plus=e.isIE&&!e.isIE_5or6,e.isOpera=/opera/.test(c.userAgent.toLowerCase()),e.isKonqueror=/konqueror/.test(c.userAgent.toLowerCase()),e}WMDEditor=function(e){this.options=WMDEditor.util.extend({},WMDEditor.defaults,e||{}),d(this,this.options),this.startEditor()},window.WMDEditor=WMDEditor,WMDEditor.defaults={version:2.1,output_format:"markdown",lineLength:40,button_bar:"wmd-button-bar",preview:"wmd-preview",output:"wmd-output",input:"wmd-input",imageDialogText:"<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://i.imgur.com/1cZl4.jpg</p>",linkDialogText:"<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://www.google.com/</p>",imageDefaultText:"http://",linkDefaultText:"http://",imageDirectory:"images/",helpLink:"/wmd/markdownhelp.html",helpHoverTitle:"Markdown Syntax",helpTarget:"_blank",previewPollInterval:500,pastePollInterval:100,buttons:"bold italic  link blockquote code image  ol ul heading hr  undo redo help",autoFormatting:{list:!0,quote:!0,code:!0},modifierKeys:{bold:"b",italic:"i",link:"l",quote:"q",code:"k",image:"g",orderedList:"o",unorderedList:"u",heading:"h",horizontalRule:"r",redo:"y",undo:"z"},tagFilter:{enabled:!1,allowedTags:/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,patternLink:/^(<a\shref=("|')(\#\d+|(https?:\/\/|ftp:\/\/|mailto:)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)\2(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,patternImage:/^(<img\ssrc="https?:(\/\/[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}},WMDEditor.prototype={getPanels:function(){return{buttonBar:"string"==typeof this.options.button_bar?document.getElementById(this.options.button_bar):this.options.button_bar,preview:"string"==typeof this.options.preview?document.getElementById(this.options.preview):this.options.preview,output:"string"==typeof this.options.output?document.getElementById(this.options.output):this.options.output,input:"string"==typeof this.options.input?document.getElementById(this.options.input):this.options.input}},startEditor:function(){this.panels=this.getPanels(),this.previewMgr=new i(this),edit=new this.editor(this.previewMgr.refresh),this.previewMgr.refresh(!0)}};var t={isVisible:function(e){return e.offsetWidth>0||e.offsetHeight>0},addEvent:function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},removeEvent:function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},fixEolChars:function(e){return e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n")},extendRegExp:function(e,t,n){(null===t||void 0===t)&&(t=""),(null===n||void 0===n)&&(n="");var r=e.toString(),o="",a=r.match(/\/([gim]*)$/);return o=null===a?a[0]:"",r=r.replace(/(^\/|\/[gim]*$)/g,""),r=t+r+n,new RegExp(r,o)},createImage:function(e){var t=imageDirectory+e,n=document.createElement("img");return n.className="wmd-button",n.src=t,n},prompt:function(e,r,o,a){var i,l,s,d,p;void 0===r&&(r="");var f=function(e){var t=e.charCode||e.keyCode;27===t&&g(!0)},g=function(e){t.removeEvent(document.body,"keydown",f);var n=s.value+(d.value?' "'+d.value+'"':"");return e?n=null:(n=n.replace("http://http://","http://"),n=n.replace("http://https://","https://"),n=n.replace("http://ftp://","ftp://"),"link"==a&&p.checked&&(n="!"+n)),i.parentNode.removeChild(i),l.parentNode.removeChild(l),o(n),!1},m=function(){l=document.createElement("div"),l.className="wmd-prompt-background",style=l.style,style.position="absolute",style.top="0",style.zIndex="10000",u.isKonqueror?style.backgroundColor="transparent":u.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var e=n.getPageSize();style.height=e[1]+"px",u.isIE?(style.left=document.documentElement.scrollLeft,style.width=document.documentElement.clientWidth):(style.left="0",style.width="100%"),document.body.appendChild(l)},h=function(){i=document.createElement("div"),i.className="wmd-prompt-dialog",i.style.padding="10px;",i.style.position="fixed",i.style.width="400px",i.style.zIndex="10001";var o=document.createElement("div");o.innerHTML=e,o.style.padding="5px",i.appendChild(o);var l=document.createElement("form");l.onsubmit=function(){return g(!1)};var m=l.style;m.padding="0",m.margin="0",m.cssFloat="left",m.width="100%",m.textAlign="center",m.position="relative",i.appendChild(l);var h=document.createElement("label");m=h.style,m.display="block",m.width="80%",m.marginLeft=m.marginRight="auto",m.textAlign="left",l.appendChild(h),h.appendChild(document.createTextNode(a+" URL:")),s=document.createElement("input"),s.type="text",s.value=r,m=s.style,m.display="block",m.width="100%",m.marginLeft=m.marginRight="auto",h.appendChild(s),h=document.createElement("label"),m=h.style,m.display="block",m.width="80%",m.marginLeft=m.marginRight="auto",m.textAlign="left",l.appendChild(h),h.appendChild(document.createTextNode(a+" Title (Hover Text):")),d=document.createElement("input"),d.type="text",m=d.style,m.display="block",m.width="100%",m.marginLeft=m.marginRight="auto",h.appendChild(d),"link"==a&&(h=document.createElement("label"),m=h.style,m.display="block",m.textAlign="center",l.appendChild(h),p=document.createElement("input"),p.type="checkbox",p.value="!",h.appendChild(p),h.appendChild(document.createTextNode(" Have this link open in a new window")));var b=document.createElement("input");b.type="button",b.onclick=function(){return g(!1)},b.value="OK",m=b.style,m.margin="10px",m.display="inline",m.width="7em";var v=document.createElement("input");v.type="button",v.onclick=function(){return g(!0)},v.value="Cancel",m=v.style,m.margin="10px",m.display="inline",m.width="7em",/mac/.test(c.platform.toLowerCase())?(l.appendChild(v),l.appendChild(b)):(l.appendChild(b),l.appendChild(v)),t.addEvent(document.body,"keydown",f),i.style.top="50%",i.style.left="50%",i.style.display="block",u.isIE_5or6&&(i.style.position="absolute",i.style.top=document.documentElement.scrollTop+200+"px",i.style.left="50%"),document.body.appendChild(i),i.style.marginTop=-(n.getHeight(i)/2)+"px",i.style.marginLeft=-(n.getWidth(i)/2)+"px"};m(),window.setTimeout(function(){h();var e=r.length;if(void 0!==s.selectionStart)s.selectionStart=0,s.selectionEnd=e;else if(s.createTextRange){var t=s.createTextRange();t.collapse(!1),t.moveStart("character",-e),t.moveEnd("character",e),t.select()}s.focus()},0)},extend:function(){function e(t,n){for(var r in n)n.hasOwnProperty(r)&&("object"==typeof t[r]&&"object"==typeof n[r]?e(t[r],n[r]):t[r]=n[r]);return t}for(var t={},n=0;n<arguments.length;n++)e(t,arguments[n]);return t}},n={getTop:function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},getHeight:function(e){return e.offsetHeight||e.scrollHeight},getWidth:function(e){return e.offsetWidth||e.scrollWidth},getPageSize:function(){var e,t,n,r;self.innerHeight&&self.scrollMaxY?(e=document.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,r=document.body.clientHeight);var o=Math.max(e,n),a=Math.max(t,r);return[o,a,n,r]}},r=function(e,n){var r=this,a=e;this.init=function(){t.isVisible(a)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=a.scrollTop,(!this.text&&a.selectionStart||0===a.selectionStart)&&(this.text=a.value))},this.setInputAreaSelection=function(){if(t.isVisible(a))if(void 0===a.selectionStart||u.isOpera){if(document.selection){if("unknown"!=typeof document.activeElement&&document.activeElement&&document.activeElement!==a)return;a.focus();var e=a.createTextRange();e.moveStart("character",-a.value.length),e.moveEnd("character",-a.value.length),e.moveEnd("character",r.end),e.moveStart("character",r.start),e.select()}}else a.focus(),a.selectionStart=r.start,a.selectionEnd=r.end,a.scrollTop=r.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(a.selectionStart||0===a.selectionStart)r.start=a.selectionStart,r.end=a.selectionEnd;else if(document.selection){r.text=t.fixEolChars(a.value);var e;n.ieRetardedClick&&n.ieCachedRange?(e=n.ieCachedRange,n.ieRetardedClick=!1):e=document.selection.createRange();var o=t.fixEolChars(e.text),i="",l=i+o+i;e.text=l;var s=t.fixEolChars(a.value);e.moveStart("character",-l.length),e.text=o,r.start=s.indexOf(i),r.end=s.lastIndexOf(i)-i.length;var c=r.text.length-t.fixEolChars(a.value).length;if(c){for(e.moveStart("character",-o.length);c--;)o+="\n",r.end+=1;e.text=o}this.setInputAreaSelection()}},this.restore=function(){void 0!=r.text&&r.text!=a.value&&(a.value=r.text),this.setInputAreaSelection(),a.scrollTop=r.scrollTop},this.getChunks=function(){var e=new o;return e.before=t.fixEolChars(r.text.substring(0,r.start)),e.startTag="",e.selection=t.fixEolChars(r.text.substring(r.start,r.end)),e.endTag="",e.after=t.fixEolChars(r.text.substring(r.end)),e.scrollTop=r.scrollTop,e},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,u.isOpera&&(e.before=e.before.replace(/\n/g,"\r\n"),e.selection=e.selection.replace(/\n/g,"\r\n"),e.after=e.after.replace(/\n/g,"\r\n")),this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()},o=function(){};o.prototype.findTags=function(e,n){var r,o=this;e&&(r=t.extendRegExp(e,"","$"),this.before=this.before.replace(r,function(e){return o.startTag=o.startTag+e,""}),r=t.extendRegExp(e,"^",""),this.selection=this.selection.replace(r,function(e){return o.startTag=o.startTag+e,""})),n&&(r=t.extendRegExp(n,"","$"),this.selection=this.selection.replace(r,function(e){return o.endTag=e+o.endTag,""}),r=t.extendRegExp(n,"^",""),this.after=this.after.replace(r,function(e){return o.endTag=e+o.endTag,""}))},o.prototype.trimWhitespace=function(e){this.selection=this.selection.replace(/^(\s*)/,""),e||(this.before+=s.$1),this.selection=this.selection.replace(/(\s*)$/,""),e||(this.after=s.$1+this.after)},o.prototype.addBlankLines=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),e++,t++;var r,o,a=/(^\n*)/.exec(this.selection);if(this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+(a?a[1]:""),a=/(\n*$)/.exec(this.selection),this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+(a?a[1]:""),a=/(^\n*)/.exec(this.startTag),this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+(a?a[1]:""),a=/(\n*$)/.exec(this.endTag),this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+(a?a[1]:""),this.before){for(r=o="";e--;)r+="\\n?",o+="\n";n&&(r="\\n*"),this.before=this.before.replace(new s(r+"$",""),o)}if(this.after){for(r=o="";t--;)r+="\\n?",o+="\n";n&&(r="\\n*"),this.after=this.after.replace(new s(r,""),o)}};var a=function(e,n,r){var o,a,i,l,s=this,c=e;this.tick=function(){if(t.isVisible(c)){if(c.selectionStart||0===c.selectionStart){var e=c.selectionStart,n=c.selectionEnd;if((e!=o||n!=a)&&(o=e,a=n,i!=c.value))return i=c.value,!0}return!1}};var u=function(){t.isVisible(c)&&s.tick()&&n()},d=function(){l=window.setInterval(u,r)};this.destroy=function(){window.clearInterval(l)},d()},i=function(e){var r,o,i,l,s,c,d=this,p=3e3,f="delayed",g=function(n,r){t.addEvent(n,"input",r),n.onpaste=r,n.ondrop=r,t.addEvent(n,"keypress",r),t.addEvent(n,"keydown",r),o=new a(e.panels.input,r,e.options.previewPollInterval)},m=function(){var e=0;return window.innerHeight?e=window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),e},h=function(){if(e.panels.preview||e.panels.output){var t=e.panels.input.value;if(!t||t!=s){s=t;var n=(new Date).getTime();!r&&e.showdown&&(r=new e.showdown.converter),r&&(t=r.makeHtml(t));var o=(new Date).getTime();l=o-n,T(t),c=t}}},b=function(){if(i&&(window.clearTimeout(i),i=void 0),"manual"!==f){var e=0;"delayed"===f&&(e=l),e>p&&(e=p),i=window.setTimeout(h,e)}},v=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)},w=function(){e.panels.preview&&(e.panels.preview.scrollTop=(e.panels.preview.scrollHeight-e.panels.preview.clientHeight)*v(e.panels.preview)),e.panels.output&&(e.panels.output.scrollTop=(e.panels.output.scrollHeight-e.panels.output.clientHeight)*v(e.panels.output))};this.refresh=function(e){e?(s="",h()):b()},this.processingTime=function(){return l},this.output=function(){return c},this.setUpdateMode=function(e){f=e,d.refresh()};var y=!0,T=function(t){var r=n.getTop(e.panels.input)-m();if(e.panels.output)if(void 0!==e.panels.output.value)e.panels.output.value=t;else{var o=t.replace(/&/g,"&amp;");o=o.replace(/</g,"&lt;"),e.panels.output.innerHTML="<pre><code>"+o+"</code></pre>"}if(e.panels.preview&&(e.options.tagFilter.enabled&&(t=t.replace(/<[^<>]*>?/gi,function(t){return t.match(e.options.tagFilter.allowedTags)||t.match(e.options.tagFilter.patternLink)||t.match(e.options.tagFilter.patternImage)?t:""})),e.panels.preview.innerHTML=t),w(),y)return y=!1,void 0;var a=n.getTop(e.panels.input)-m();u.isIE?window.setTimeout(function(){window.scrollBy(0,a-r)},0):window.scrollBy(0,a-r)},k=function(){g(e.panels.input,b),h(),e.panels.preview&&(e.panels.preview.scrollTop=0),e.panels.output&&(e.panels.output.scrollTop=0)};this.destroy=function(){o&&o.destroy()},k()},l=function(e,n,o,i){var l,s,c,d,p=this,f=[],g=0,m="none",h=function(e,t){m!=e&&(m=e,t||v()),u.isIE&&"moving"==m?d=null:c=window.setTimeout(b,1)},b=function(){d=new r(n,e),s.tick(),c=void 0};this.setCommandMode=function(){m="command",v(),c=window.setTimeout(b,0)},this.canUndo=function(){return g>1},this.canRedo=function(){return f[g+1]?!0:!1},this.undo=function(){p.canUndo()&&(l?(l.restore(),l=null):(f[g]=new r(n,e),f[--g].restore(),i&&i())),m="none",n.focus(),b()},this.redo=function(){p.canRedo()&&(f[++g].restore(),i&&i()),m="none",n.focus(),b()};var v=function(){var t=d||new r(n,e);return t?"moving"==m?(l||(l=t),void 0):(l&&(f[g-1].text!=l.text&&(f[g++]=l),l=null),f[g++]=t,f[g+1]=null,i&&i(),void 0):!1},w=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode,r=String.fromCharCode(n);switch(r){case"y":p.redo(),t=!0;break;case"z":e.shiftKey?p.redo():p.undo(),t=!0}}return t?(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1),void 0):void 0},y=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&40>=t||t>=63232&&63235>=t?h("moving"):8==t||46==t||127==t?h("deleting"):13==t?h("newlines"):27==t?h("escape"):(16>t||t>20)&&91!=t&&h("typing")}},T=function(){t.addEvent(n,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(u.isIE||d&&d.text!=n.value)&&void 0==c&&(m="paste",v(),b())};s=new a(n,e,o),t.addEvent(n,"keydown",w),t.addEvent(n,"keydown",y),t.addEvent(n,"mousedown",function(){h("moving")}),n.onpaste=e,n.ondrop=e},k=function(){T(),b(),v()};this.destroy=function(){s&&s.destroy()},k()};WMDEditor.util=t,WMDEditor.position=n,WMDEditor.TextareaState=r,WMDEditor.InputPoller=a,WMDEditor.PreviewManager=i,WMDEditor.UndoManager=l,window.document;var s=window.RegExp,c=window.navigator,u=e(),d=function(e,t){e.Command={},e.Global={},e.buttons={},e.showdown=window.Showdown;var n=WMDEditor.util;WMDEditor.position;var o=e.Command;e.ieCachedRange=null,e.ieRetardedClick=!1,e.editor=function(a){a||(a=function(){});var i,s,d,p=e.panels.input,f=this,g=function(t){if(p.focus(),t.textOp){d&&d.setCommandMode();var n=new r(e.panels.input,e);if(!n)return;var o=n.getChunks(),i=function(){p.focus(),o&&n.setChunks(o),n.restore(),a()},l=!0,s=t.textOp(o,i,l);s||i()}t.execute&&t.execute(f)},m=function(){d&&(e.buttons["wmd-undo-button"]&&h(e.buttons["wmd-undo-button"],d.canUndo()),e.buttons["wmd-redo-button"]&&h(e.buttons["wmd-redo-button"],d.canRedo()))},h=function(t,n){n?(t.className=t.className.replace(new RegExp("(^|\\s+)disabled(\\s+|$)")," "),u.isIE&&(t.onmousedown=function(){e.ieRetardedClick=!0,e.ieCachedRange=document.selection.createRange()}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),g(this),!1})):(t.className+=(t.className?" ":"")+"disabled",t.onmouseover=t.onmouseout=t.onclick=function(){})},b=function(){function n(t,n,r){var o=document.createElement("li");return e.buttons[t]=o,o.className="wmd-button "+t,o.XShift=s+"px",s-=20,n&&(o.title=n),r&&(o.textOp=r),o}function r(e,t,r){var o=n(e,t,r);return h(o,!0),l.appendChild(o),o}function a(){var e=document.createElement("li");return e.className="wmd-spacer",l.appendChild(e),e}var i="string"==typeof t.button_bar?document.getElementById(t.button_bar||"wmd-button-bar"):t.button_bar,l=document.createElement("ul");l.className="wmd-button-row",l=i.appendChild(l);for(var s=0,u=t.buttons.split(" "),d=0;d<u.length;d++)switch(u[d]){case"bold":r("wmd-bold-button","Strong <strong> Ctrl+B",o.doBold);break;case"italic":r("wmd-italic-button","Emphasis <em> Ctrl+I",o.doItalic);break;case"link":r("wmd-link-button","Hyperlink <a> Ctrl+L",function(e,t){return o.doLinkOrImage(e,t,!1)});break;case"blockquote":r("wmd-quote-button","Blockquote <blockquote> Ctrl+Q",o.doBlockquote);break;case"code":r("wmd-code-button","Code Sample <pre><code> Ctrl+K",o.doCode);break;case"image":r("wmd-image-button","Image <img> Ctrl+G",function(e,t){return o.doLinkOrImage(e,t,!0)});break;case"ol":r("wmd-olist-button","Numbered List <ol> Ctrl+O",function(e,t,n){o.doList(e,t,!0,n)});break;case"ul":r("wmd-ulist-button","Bulleted List <ul> Ctrl+U",function(e,t,n){o.doList(e,t,!1,n)});break;case"heading":r("wmd-heading-button","Heading <h1>/<h2> Ctrl+H",o.doHeading);break;case"hr":r("wmd-hr-button","Horizontal Rule <hr> Ctrl+R",o.doHorizontalRule);break;case"undo":var p=r("wmd-undo-button","Undo - Ctrl+Z");p.execute=function(e){e.undo()};break;case"redo":var f=r("wmd-redo-button","Redo - Ctrl+Y");f.title=/win/.test(c.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z",f.execute=function(e){e.redo()};break;case"help":var g=n("wmd-help-button");g.isHelp=!0,h(g,!0),l.appendChild(g);var b=document.createElement("a");b.href=t.helpLink,b.target=t.helpTarget,b.title=t.helpHoverTitle,g.appendChild(b);break;case"":a()}m()},v=function(){/\?noundo/.test(document.location.href)&&(e.nativeUndo=!0),e.nativeUndo||(d=new l(e,e.panels.input,e.options.pastePollInterval,function(){a(),m()})),b();var t="keydown";u.isOpera&&(t="keypress"),n.addEvent(p,t,function(t){if(e.options.modifierKeys&&(t.ctrlKey||t.metaKey)){var n=t.charCode||t.keyCode,r=String.fromCharCode(n).toLowerCase();switch(r){case e.options.modifierKeys.bold:if(!e.buttons["wmd-bold-button"])return;g(e.buttons["wmd-bold-button"]);break;case e.options.modifierKeys.italic:if(!e.buttons["wmd-italic-button"])return;g(e.buttons["wmd-italic-button"]);break;case e.options.modifierKeys.link:if(!e.buttons["wmd-link-button"])return;g(e.buttons["wmd-link-button"]);break;case e.options.modifierKeys.quote:if(!e.buttons["wmd-quote-button"])return;g(e.buttons["wmd-quote-button"]);break;case e.options.modifierKeys.code:if(!e.buttons["wmd-code-button"])return;g(e.buttons["wmd-code-button"]);break;case e.options.modifierKeys.image:if(!e.buttons["wmd-image-button"])return;g(e.buttons["wmd-image-button"]);break;case e.options.modifierKeys.orderedList:if(!e.buttons["wmd-olist-button"])return;g(e.buttons["wmd-olist-button"]);break;case e.options.modifierKeys.unorderedList:if(!e.buttons["wmd-ulist-button"])return;g(e.buttons["wmd-ulist-button"]);break;case e.options.modifierKeys.heading:if(!e.buttons["wmd-heading-button"])return;g(e.buttons["wmd-heading-button"]);break;case e.options.modifierKeys.horizontalRule:if(!e.buttons["wmd-hr-button"])return;g(e.buttons["wmd-hr-button"]);break;case e.options.modifierKeys.redo:if(!e.buttons["wmd-redo-button"])return;g(e.buttons["wmd-redo-button"]);break;case e.options.modifierKeys.undo:if(t.shiftKey){if(!e.buttons["wmd-redo-button"])return;g(e.buttons["wmd-redo-button"])}else{if(!e.buttons["wmd-undo-button"])return;g(e.buttons["wmd-undo-button"])}break;default:return}t.preventDefault&&t.preventDefault(),window.event&&(window.event.returnValue=!1)}}),n.addEvent(p,"keyup",function(e){if(!e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;13===t&&(fakeButton={},fakeButton.textOp=o.doAutoindent,g(fakeButton))}}),u.isIE&&n.addEvent(p,"keydown",function(e){var t=e.keyCode;return 27===t?!1:void 0})};this.undo=function(){d&&d.undo()},this.redo=function(){d&&d.redo()};var w=function(){v()};this.destroy=function(){d&&d.destroy(),i.parentNode&&i.parentNode.removeChild(i),p&&(p.style.marginTop=""),window.clearInterval(s)},w()},o.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",o.unwrap=function(e){var t=new s("([^\\n])\\n(?!(\\n|"+o.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},o.wrap=function(e,t){o.unwrap(e);var n=new s("(.{1,"+t+"})( +|$\\n?)","gm");e.selection=e.selection.replace(n,function(e,t){return new s("^"+o.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},o.doBold=function(e){return o.doBorI(e,2,"strong text")},o.doItalic=function(e){return o.doBorI(e,1,"emphasized text")},o.doBorI=function(e,t,n){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n"),e.before.search(/(\**$)/);var r=s.$1;e.after.search(/(^\**)/);var o=s.$1,a=Math.min(r.length,o.length);if(a>=t&&(2!=a||1!=t))e.before=e.before.replace(s("[*]{"+t+"}$",""),""),e.after=e.after.replace(s("^[*]{"+t+"}",""),"");else if(!e.selection&&o){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var i=s.$1;e.before=e.before+o+i}else{e.selection||o||(e.selection=n);var l=1>=t?"*":"**";e.before=e.before+l,e.after=l+e.after}},o.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,r,o,a){return t[n]=e.replace(/\s*$/,""),o?(t[n]=e.replace(/["(](.+?)[")]$/,""),o+a):""})},o.addLinkDef=function(e,t){var n=0,r={};e.before=o.stripLinkDefs(e.before,r),e.selection=o.stripLinkDefs(e.selection,r),e.after=o.stripLinkDefs(e.after,r);var a="",i=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,l=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),a+="\n"+e},s=function(e,t,o,a){return r[o]?(l(r[o]),t+n+a):e};e.before=e.before.replace(i,s),t?l(t):e.selection=e.selection.replace(i,s);var c=n;return e.after=e.after.replace(i,s),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+a,c},o.doLinkOrImage=function(e,r,a){if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1)){if(/\n\n/.test(e.selection))return o.addLinkDef(e,null),void 0;var i=function(t){if(console.log(t),null!==t){e.startTag=e.endTag="";var n=" [999]: "+t,i=o.addLinkDef(e,n);e.startTag=a?"![":"[",e.endTag="]["+i+"]",e.selection||(e.selection=a?"alt text":"link text")}r()};return a?n.prompt(t.imageDialogText,t.imageDefaultText,i,"Image"):n.prompt(t.linkDialogText,t.linkDefaultText,i,"Link"),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",o.addLinkDef(e,null)},o.doAutoindent=function(t,n,r){e.options.autoFormatting&&(e.options.autoFormatting.list&&(t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n")),e.options.autoFormatting.quote&&(t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n")),e.options.autoFormatting.code&&(t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n")),r=!1,/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(t.before)&&o.doList&&e.options.autoFormatting.list&&o.doList(t,n,!1,!0),/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(t.before)&&o.doList&&e.options.autoFormatting.list&&o.doList(t,n,!0,!0),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)&&o.doBlockquote&&e.options.autoFormatting.quote&&o.doBlockquote(t,n,r),/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)&&o.doCode&&e.options.autoFormatting.code&&o.doCode(t,n,r))},o.doBlockquote=function(e,n,r){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,r,o){return e.before+=n,e.after=o+e.after,r}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""});var a=r?"Blockquote":"";e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||a,e.before&&(e.before=e.before.replace(/\n?$/,"\n")),e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.before=e.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(t){return e.startTag=t,""}),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var i=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(o.wrap(e,t.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),i(!0),e.addBlankLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),o.unwrap(e),i(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},o.doCode=function(e,t,n){var r=/\S[ ]*$/.test(e.before),o=/^[ ]*\S/.test(e.after);if(!o&&!r||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var a=1,i=1;(/\n(\t|[ ]{4,}).*\n$/.test(e.before)||""===e.after)&&(a=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(i=0),e.addBlankLines(a,i),e.selection?e.selection=/^[ ]{0,3}\S/m.test(e.selection)?e.selection.replace(/^/gm,"    "):e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection=n?"enter code here":"")}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=n?"enter code here":""))},o.doList=function(e,n,r,a){var i=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,l=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,c="-",u=1,d=function(){var e;return r?(e=" "+u+". ",u++):e=" "+c+" ",e},p=function(e){return void 0===r&&(r=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return d()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var f=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),o.unwrap(e),e.addBlankLines(),f&&(e.after=e.after.replace(l,p)),r==f)return}var g=1;e.before=e.before.replace(i,function(e){return/^\s*([*+-])/.test(e)&&(c=s.$1),g=/[^\n]\n\n[^\n]/.test(e)?1:0,p(e)}),e.selection||(e.selection=a?"List item":" ");var m=d(),h=1;e.after=e.after.replace(l,function(e){return h=/[^\n]\n\n[^\n]/.test(e)?1:0,p(e)}),e.trimWhitespace(!0),e.addBlankLines(g,h,!0),e.startTag=m;var b=m.replace(/./g," ");o.wrap(e,t.lineLength-b.length),e.selection=e.selection.replace(/\n/g,"\n"+b)},o.doHeading=function(e){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection="Heading",e.endTag=" ##",void 0;var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=s.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.addBlankLines(1,1);var r=0==n?2:n-1;if(r>0){var o=r>=2?"-":"=",a=e.selection.length;for(a>t.lineLength&&(a=t.lineLength),e.endTag="\n";a--;)e.endTag+=o}},o.doHorizontalRule=function(e){e.startTag="----------\n",e.selection="",e.addBlankLines(2,1,!0)}}}(),Showdown={},Showdown.converter=function(){var e,t,n,r=0;this.makeHtml=function(r){return e=[],t=[],n=[],r=r.replace(/~/g,"~T"),r=r.replace(/\$/g,"~D"),r=r.replace(/\r\n/g,"\n"),r=r.replace(/\r/g,"\n"),r="\n\n"+r+"\n\n",r=H(r),r=r.replace(/^[ \t]+$/gm,""),r=i(r),r=a(r),r=s(r),r=I(r),r=r.replace(/~D/g,"$$"),r=r.replace(/~T/g,"~"),r=r.replace(/https?\:\/\/[^"\s<>]*[^.,;'">\:\s<>\)\]\!]/g,function(e,t){var n=r.slice(Math.max(0,r.lastIndexOf("\n",t)),t),o=r.slice(t);return n.match(/<([a-z]+)\s[^>]+>?$/)&&o.match(/^[^>]*>/)?e:"<a href='"+e+"'>"+e+"</a>"}),r=r.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9\-]+)+/gi,function(e,t,n){var o=r.slice(Math.max(0,r.lastIndexOf("\n",n)),n);return o.match(/<([a-z]+)\s[^>]+>?$/)||o.match(/mailto\:$/)?e:"<a href='mailto:"+e+"'>"+e+"</a>"})};var o,a=function(n){return n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(n,r,o,a,i){return r=r.toLowerCase(),e[r]=x(o),a?a+i:(i&&(t[r]=i.replace(/"/g,"&quot;")),"")})},i=function(e){return e=e.replace(/\n/g,"\n\n"),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,l),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/\n\n/g,"\n")},l=function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(n.push(r)-1)+"K\n\n"},s=function(e){e=m(e);var t=v("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=h(e),e=b(e),e=k(e),e=i(e),e=E(e)},c=function(e){return e=w(e),e=u(e),e=$(e),e=f(e),e=d(e),e=L(e),e=x(e),e=C(e),e=T(e),e=e.replace(/ {2,}\n/g," <br />\n")},u=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=M(t,"\\`*_")})},d=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,p)},p=function(n,r,o,a,i,l,s,c){void 0===c&&(c="");var u=r,d=o,p=a.toLowerCase(),f=i,g=c,m=!1;if(""===f)if(""===p?p=d.toLowerCase().replace(/ ?\n/g," "):"!"==p[0]&&(m=!0,p=p.substr(1)),f="#"+p,void 0!==e[p])f=e[p],void 0!==t[p]&&(g=t[p]),"!"==f[0]&&(m=!0,f=f.substr(1));else{if(!(u.search(/\(\s*\)$/m)>-1))return u;f=""}else"!"==f[0]&&(m=!0,f=f.substr(1));f=M(f,"*_");var h='<a href="'+f+'"';return""!==g&&(g=g.replace(/"/g,"&quot;"),g=M(g,"*_"),h+=' title="'+g+'"'),m&&(h+=' target="_blank"'),h+=">"+d+"</a>"},f=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,g),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,g)},g=function(n,r,o,a,i,l,s,c){var u=r,d=o,p=a.toLowerCase(),f=i,g=c;if(g||(g=""),""===f){if(""===p&&(p=d.toLowerCase().replace(/ ?\n/g," ")),f="#"+p,void 0===e[p])return u;f=e[p],void 0!==t[p]&&(g=t[p])}d=d.replace(/"/g,"&quot;"),f=M(f,"*_");var m='<img src="'+f+'" alt="'+d+'"';return g=g.replace(/"/g,"&quot;"),g=M(g,"*_"),m+=' title="'+g+'"',m+=" />"},m=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return v("<h1>"+c(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return v("<h2>"+c(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return v("<h"+r+">"+c(n)+"</h"+r+">")})},h=function(e){e+="~0";var t=/^(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,n){var r=t,a=n.search(/[*+\-]/g)>-1?"ul":"ol";r=r.replace(/\n{2,}/g,"\n\n\n");var i=o(r);
return i=i.replace(/\s+$/,""),i="<"+a+">"+i+"</"+a+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,r){var a=t,i=n,l=r.search(/[*+\-]/g)>-1?"ul":"ol";i=i.replace(/\n{2,}/g,"\n\n\n");var s=o(i);return s=a+"<"+l+">\n"+s+"</"+l+">\n"})),e=e.replace(/~0/,"")};o=function(e){return r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+\-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+\-]|\d+[.])[ \t]+))/gm,function(e,t,n,r,o){var a=o,i=t;return i||a.search(/\n{2,}/)>-1?a=s(D(a)):(a=h(D(a)),a=a.replace(/\n$/,""),a=c(a)),"<li>"+a+"</li>\n"}),e=e.replace(/~0/g,""),r--,e};var b=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,o=n;return r=y(D(r)),r=H(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>",v(r)+o}),e=e.replace(/~0/,"")},v=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"},w=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r){var o=r;return o=o.replace(/^([ \t]*)/g,""),o=o.replace(/[ \t]*$/g,""),o=y(o),t+"<code>"+o+"</code>"}),e=e.replace(/(^|[^\\])(\^{2})([^\r]*?[^\^]{2})\2(?!\^)/gm,function(e,t,n,r){var o=r;return o=o.replace(/^([ \t]*)/g,""),o=o.replace(/[ \t]*$/g,""),o=y(o),t+"<sup>"+o+"</sup>"}),e=e.replace(/(^|[^\\])(,{2})([^\r]*?[^,]{2})\2(?!,)/gm,function(e,t,n,r){var o=r;return o=o.replace(/^([ \t]*)/g,""),o=o.replace(/[ \t]*$/g,""),o=y(o),t+"<sub>"+o+"</sub>"}),e=e.replace(/(^|[^\\])(~T~T)([^\r]*?[^~]{2})\2(?!~)/gm,function(e,t,n,r){var o=r;return o=o.replace(/^([ \t]*)/g,""),o=o.replace(/[ \t]*$/g,""),o=y(o),t+"<strike>"+o+"</strike>"})},y=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;"),e=M(e,"*_{}[]\\",!1)},T=function(e){return e=e.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\w)_(\w)/g,"$1~E95E$2"),e=e.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>"),e=e.replace(/(_)(?=\S)([^\r]*?\S)\1/g,"<u>$2</u>"),e},k=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=s(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^ {2}/gm,"~0"),n=n.replace(/~0/g,"")}),v("<blockquote>\n"+n+"\n</blockquote>")})},E=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");var t,r=e.split(/\n{2,}/g),o=[],a=r.length;for(t=0;a>t;t++){var i=r[t],l="<p>";i.search(/~K(\d+)K/g)>=0?o.push(i):i.search(/\S/)>=0&&(i=c(i),"->"===i.substr(0,2)&&("&lt;-"===i.substr(-5)?(l='<p align="center">',i=i.slice(2,-5)):(l='<p align="right">',i=i.substring(2))),i=i.replace(/\n/g,"<br />"),i=i.replace(/^([ \t]*)/g,l),i+="</p>",o.push(i))}for(a=o.length,t=0;a>t;t++)for(;o[t].search(/~K(\d+)K/)>=0;){var s=n[RegExp.$1];s=s.replace(/\$/g,"$$$$"),o[t]=o[t].replace(/~K\d+K/,s)}return o.join("\n\n")},x=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),e=e.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;")},C=function(e){return e=e.replace(/\.\.\./g,"&hellip;").replace(/\(c\)/g,"&copy;").replace(/\(r\)/g,"&reg;").replace(/\(tm\)/g,"&trade;").replace(/\-\-/g,"&mdash;")},$=function(e){return e=e.replace(/\\(\\)/g,q),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,q)},L=function(e){return e=e.replace(/(?:")<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([\-.\w]+\@[\-a-z0-9]+(\.[\-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return S(I(t))})},S=function(e){function t(e){var t="0123456789ABCDEF",n=e.charCodeAt(0);return t.charAt(n>>4)+t.charAt(15&n)}var n=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=n[Math.floor(2*Math.random())](e);else if(":"!=e){var t=Math.random();e=t>.9?n[2](e):t>.45?n[1](e):n[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},I=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t,10);return String.fromCharCode(n)})},D=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},H=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var n=t,r=4-n.length%4,o=0;r>o;o++)n+=" ";return n}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},M=function(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var o=new RegExp(r,"g");return e=e.replace(o,q)},q=function(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}};var initializeWMDEditor=function(){new WMDEditor({input:"item_description",button_bar:"editor-button-bar",preview:"editor-preview",output:"editor-output"}),$(".wmd-help-button").html("<a id='markdown-help-link'></a>"),$("#markdown-help-link").click(function(){return $("#editor-help-panel").slideToggle("fast"),!1})};$(function(){initializeWMDEditor()}),$(document).on("page:load",initializeWMDEditor);